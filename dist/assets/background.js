chrome.runtime.onInstalled.addListener(async t=>{t.reason==="install"&&(chrome.storage.sync.set({toggleState:!0}).catch(()=>{console.log("[STORAGE] Could not set storage item")}),chrome.tabs.query({url:["https://www.reddit.com/*"]},function(o){o.forEach(i=>{chrome.tabs.reload(i.id)})}))});function c(){return chrome.runtime.id?chrome.storage.sync.get(["toggleState","keywordList","linkList","articleSwitch"]):location.reload()}chrome.runtime.onMessage.addListener(async function(t,o,i){if(t.checkStates){const e=await c();chrome.tabs.query({url:["https://www.reddit.com/*"]},function(r){r.forEach(n=>{e.articleSwitch&&s(n.id)})})}if(t.keywordList){const e=await c();chrome.tabs.query({url:["https://www.reddit.com/*"]},function(r){r.forEach(n=>{t.keywordList==="add"&&d(n.id,e.keywordList)})})}if(t.linkList){const e=await c();chrome.tabs.query({url:["https://www.reddit.com/*"]},function(r){r.forEach(n=>{t.linkList==="add"&&l(n.id,e.linkList)})})}});chrome.tabs.onUpdated.addListener(async function(t,o,i){if(chrome.runtime.id&&i.url.startsWith("https://www.reddit.com/")){const e=await c();if(console.log(e),!e.toggleState||o.status!=="loading")return;e.articleSwitch&&s(t),e.keywordList&&e.keywordList.length>0&&d(t,e.keywordList),e.linkList&&e.linkList.length>0&&l(t,e.linkList)}});function s(t){chrome.scripting.executeScript({target:{tabId:t},function:()=>{setInterval(()=>{var o=document.querySelectorAll("article");o.forEach(function(i){var e=i.parentNode.parentNode.parentNode;e.style.display="none"})},500)}})}function d(t,o){o.forEach(i=>{chrome.scripting.executeScript({target:{tabId:t},function:e=>{setInterval(()=>{var r=document.querySelectorAll("h3");r.forEach(function(n){if(n.innerText.toLowerCase().includes(e)){const a=n.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;a.style.display="none"}});var r=document.querySelectorAll("p");r.forEach(function(n){if(n.innerText.toLowerCase().includes(e)){const a=n.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;a.style.display="none"}})},500)},args:[i]})})}function l(t,o){o.forEach(i=>{chrome.scripting.executeScript({target:{tabId:t},function:e=>{setInterval(()=>{var r=document.querySelectorAll("a");r.forEach(function(n){if(n.innerText.toLowerCase().includes(e)&&n.parentNode.parentNode.parentNode.tagName.toLowerCase()==="article"){const u=n.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;u.style.display="none"}})},500)},args:[i]})})}
